{% extends "base.html" %}

{% block title %}Create Student - NanaPatha{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto space-y-6">
    <!-- Page Header -->
    <div class="flex items-center space-x-4">
        <a href="{{ url_for('admin_students') }}" 
           class="p-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-md transition-colors duration-150">
            <i class="fas fa-arrow-left"></i>
        </a>
        
        <div>
            <h1 class="text-2xl font-semibold text-gray-900">Add New Student</h1>
            <p class="text-sm text-gray-500 mt-1">Create a new student account and profile</p>
        </div>
    </div>

    <!-- Student Creation Form -->
    <div class="bg-white rounded-lg shadow p-8">
        <form method="POST" class="space-y-8" enctype="multipart/form-data">
            <!-- Basic Information -->
            <div>
                <h3 class="text-lg font-medium text-gray-900 mb-4">
                    <i class="fas fa-user text-brand mr-2"></i>
                    Basic Information
                </h3>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Full Name -->
                    <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Full Name <span class="text-red-500">*</span>
                        </label>
                        <input type="text" name="name" required
                               placeholder="Enter student's full name" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-brand focus:border-transparent">
                    </div>
                    
                    <!-- Email -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Email Address <span class="text-red-500">*</span>
                        </label>
                        <input type="email" name="email" required
                               placeholder="student@example.com" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-brand focus:border-transparent">
                    </div>
                    
                    <!-- Phone -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Phone Number <span class="text-red-500">*</span>
                        </label>
                        <input type="tel" name="phone" required
                               placeholder="+94 XX XXX XXXX" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-brand focus:border-transparent">
                    </div>
                </div>
            </div>

            <!-- Student Profile Information -->
            <div class="border-t pt-8">
                <h3 class="text-lg font-medium text-gray-900 mb-4">
                    <i class="fas fa-graduation-cap text-brand mr-2"></i>
                    Student Details
                </h3>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Grade -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Grade Level <span class="text-red-500">*</span>
                        </label>
                        <select name="grade" required
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-brand focus:border-transparent">
                            <option value="">Select Grade</option>
                            <option value="6">Grade 6</option>
                            <option value="7">Grade 7</option>
                            <option value="8">Grade 8</option>
                            <option value="9">Grade 9</option>
                            <option value="10">Grade 10</option>
                            <option value="11">Grade 11</option>
                            <option value="12">Grade 12</option>
                            <option value="13">Grade 13</option>
                        </select>
                    </div>
                    
                    <!-- School -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            School
                        </label>
                        <input type="text" name="school"
                               placeholder="School name" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-brand focus:border-transparent">
                    </div>
                    
                    <!-- Guardian Name -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Parent/Guardian Name
                        </label>
                        <input type="text" name="guardian_name"
                               placeholder="Parent or guardian full name" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-brand focus:border-transparent">
                    </div>
                    
                    <!-- Guardian Phone -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Parent/Guardian Phone
                        </label>
                        <input type="tel" name="guardian_phone"
                               placeholder="+94 XX XXX XXXX" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-brand focus:border-transparent">
                    </div>
                    
                    <!-- Emergency Contact -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Emergency Contact
                        </label>
                        <input type="tel" name="emergency_contact"
                               placeholder="Emergency contact number" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-brand focus:border-transparent">
                    </div>
                    
                    <!-- Batch Assignment -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Assign to Batch
                        </label>
                        <select name="batch_id"
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-brand focus:border-transparent">
                            <option value="">No batch assignment</option>
                            {% for batch in batches %}
                                <option value="{{ batch.id }}">{{ batch.name }}</option>
                            {% endfor %}
                        </select>
                        <p class="text-xs text-gray-500 mt-1">Batches can be assigned later</p>
                    </div>
                </div>
            </div>

            <!-- Address Information -->
            <div class="border-t pt-8">
                <h3 class="text-lg font-medium text-gray-900 mb-4">
                    <i class="fas fa-map-marker-alt text-brand mr-2"></i>
                    Address Information
                </h3>
                
                <div class="space-y-4">
                    <!-- Address Line 1 -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Address Line 1
                        </label>
                        <input type="text" name="address_line1"
                               placeholder="House number and street name" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-brand focus:border-transparent">
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <!-- City -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                City
                            </label>
                            <input type="text" name="city"
                                   placeholder="City" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-brand focus:border-transparent">
                        </div>
                        
                        <!-- State/Province -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                District
                            </label>
                            <input type="text" name="district"
                                   placeholder="District" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-brand focus:border-transparent">
                        </div>
                        
                        <!-- Postal Code -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Postal Code
                            </label>
                            <input type="text" name="postal_code"
                                   placeholder="00000" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-brand focus:border-transparent">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Account Settings -->
            <div class="border-t pt-8">
                <h3 class="text-lg font-medium text-gray-900 mb-4">
                    <i class="fas fa-cog text-brand mr-2"></i>
                    Account Settings
                </h3>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Student ID Number -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Student ID Number
                        </label>
                        <input type="text" name="student_id_number"
                               placeholder="Auto-generated if empty" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-brand focus:border-transparent">
                        <p class="text-xs text-gray-500 mt-1">Leave empty to auto-generate</p>
                    </div>
                    
                    <!-- Status -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Account Status
                        </label>
                        <select name="status"
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-brand focus:border-transparent">
                            <option value="active">Active</option>
                            <option value="inactive">Inactive</option>
                            <option value="pending">Pending</option>
                        </select>
                    </div>
                </div>
                
                <!-- Send Welcome Email -->
                <div class="mt-6">
                    <label class="flex items-center">
                        <input type="checkbox" name="send_welcome_email" checked
                               class="w-4 h-4 text-brand border-gray-300 rounded focus:ring-brand">
                        <span class="ml-2 text-sm text-gray-700">
                            Send welcome email with login credentials
                        </span>
                    </label>
                </div>
            </div>

            <!-- Form Actions -->
            <div class="border-t pt-8 flex items-center justify-end space-x-4">
                <a href="{{ url_for('admin_students') }}" 
                   class="px-6 py-2 text-sm font-medium text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300 transition-colors duration-150">
                    Cancel
                </a>
                
                <button type="submit" 
                        class="px-6 py-2 text-sm font-medium text-white bg-brand rounded-md hover:bg-brand-700 transition-colors duration-150">
                    <i class="fas fa-save mr-2"></i>
                    Create Student
                </button>
            </div>
        </form>
    </div>
</div>

<script>
// Auto-generate student ID based on name and grade
document.addEventListener('DOMContentLoaded', function() {
    const nameInput = document.querySelector('input[name="name"]');
    const gradeSelect = document.querySelector('select[name="grade"]');
    const studentIdInput = document.querySelector('input[name="student_id_number"]');
    
    function generateStudentId() {
        if (studentIdInput.value.trim() === '' && nameInput.value && gradeSelect.value) {
            const initials = nameInput.value.split(' ')
                .map(word => word.charAt(0).toUpperCase())
                .join('');
            const year = new Date().getFullYear();
            const grade = gradeSelect.value.padStart(2, '0');
            const random = Math.floor(Math.random() * 1000).toString().padStart(3, '0');
            
            studentIdInput.placeholder = `${year}${grade}${initials}${random}`;
        }
    }
    
    nameInput.addEventListener('input', generateStudentId);
    gradeSelect.addEventListener('change', generateStudentId);
});
</script>
{% endblock %}